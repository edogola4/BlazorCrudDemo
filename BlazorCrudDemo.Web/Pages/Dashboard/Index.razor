@page "/"
@page "/dashboard"
@using BlazorCrudDemo.Web.Utilities

<PageTitle>Dashboard</PageTitle>

<!-- Dashboard content now works within MainLayout structure -->
<div class="dashboard-container">
    <div class="dashboard-content">
        @if (isLoading)
        {
            <!-- Loading Skeleton -->
            <div class="loading-container">
                <div class="skeleton-grid">
                    @for (int i = 0; i < 4; i++)
                    {
                        <div class="skeleton-card">
                            <div class="skeleton-header"></div>
                            <div class="skeleton-body"></div>
                            <div class="skeleton-footer"></div>
                        </div>
                    }
                </div>
            </div>
        }
        else if (hasError)
        {
            <!-- Error State -->
            <div class="error-container">
                <div class="error-card">
                    <div class="error-icon" aria-hidden="true">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3>Unable to Load Dashboard</h3>
                    <p>We encountered an issue while fetching your data. Please try again.</p>
                    <div class="error-actions">
                        <button class="btn btn-primary" @onclick="RefreshDashboard" aria-label="Retry loading dashboard">
                            <i class="fas fa-redo" aria-hidden="true"></i>
                            <span>Try Again</span>
                        </button>
                        <button class="btn btn-secondary" @onclick="NavigateToHome">
                            <i class="fas fa-home" aria-hidden="true"></i>
                            <span>Go Home</span>
                        </button>
                    </div>
                </div>
            </div>
        }
<div class="dashboard-controls">
                    <div class="search-bar">
                        <i class="fas fa-search" aria-hidden="true"></i>
                        <input type="text" placeholder="Search dashboard..." @bind="searchQuery" @bind:event="oninput" />
                        @if (!string.IsNullOrEmpty(searchQuery))
                        {
                            <button class="clear-search-btn" @onclick="ClearSearch" aria-label="Clear search">
                                <i class="fas fa-times" aria-hidden="true"></i>
                            </button>
                        }
                    </div>
                    <div class="filters">
                        <select @bind="selectedFilter" @bind:event="onchange">
                            <option value="all">All Activities</option>
                            <option value="orders">Orders</option>
                            <option value="products">Products</option>
                            <option value="categories">Categories</option>
                            <option value="inventory">Inventory</option>
                        </select>
                        <button class="btn btn-primary" @onclick="RefreshDashboard">
                            <i class="fas fa-sync" aria-hidden="true"></i>
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Main Dashboard Layout -->
                <div class="dashboard-layout">
                <!-- Stats Overview -->
                <section class="stats-section" aria-labelledby="stats-heading">
                    <h2 id="stats-heading" class="section-title">Key Metrics</h2>
                    <div class="stats-grid">
                        <!-- Total Products Card -->
                        <div class="stat-card card-primary" tabindex="0" role="button">
                            <div class="stat-card-bg"></div>
                            <div class="stat-header">
                                <div class="stat-icon-wrapper">
                                    <i class="fas fa-box" aria-hidden="true"></i>
                                </div>
                                <div class="stat-trend @(stats.ProductsTrend >= 0 ? "trend-positive" : "trend-negative")">
                                    <i class="fas fa-arrow-@(stats.ProductsTrend >= 0 ? "up" : "down")" aria-hidden="true"></i>
                                    <span>@Math.Abs(stats.ProductsTrend)%</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <h3 class="stat-value">@stats.TotalProducts.ToString("N0")</h3>
                                <p class="stat-label">Total Products</p>
                            </div>
                            <div class="stat-footer">
                                <span class="stat-meta">
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    Active inventory
                                </span>
                            </div>
                        </div>

                        <!-- Total Categories Card -->
                        <div class="stat-card card-warning">
                            <div class="stat-card-bg"></div>
                            <div class="stat-header">
                                <div class="stat-icon-wrapper">
                                    <i class="fas fa-folder" aria-hidden="true"></i>
                                </div>
                                <div class="stat-trend @(stats.CategoriesTrend >= 0 ? "trend-positive" : "trend-negative")">
                                    <i class="fas fa-arrow-@(stats.CategoriesTrend >= 0 ? "up" : "down")" aria-hidden="true"></i>
                                    <span>@Math.Abs(stats.CategoriesTrend)%</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <h3 class="stat-value">@stats.TotalCategories.ToString("N0")</h3>
                                <p class="stat-label">Categories</p>
                            </div>
                            <div class="stat-footer">
                                <span class="stat-meta">
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    Product groups
                                </span>
                            </div>
                        </div>

                        <!-- Recent Activity Card -->
                        <div class="stat-card card-danger">
                            <div class="stat-card-bg"></div>
                            <div class="stat-header">
                                <div class="stat-icon-wrapper">
                                    <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                                </div>
                                <div class="stat-trend @(stats.LowStockTrend <= 0 ? "trend-positive" : "trend-negative")">
                                    <i class="fas fa-arrow-@(stats.LowStockTrend <= 0 ? "down" : "up")" aria-hidden="true"></i>
                                    <span>@Math.Abs(stats.LowStockTrend)%</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <h3 class="stat-value">@stats.LowStockItems.ToString("N0")</h3>
                                <p class="stat-label">Low Stock Alert</p>
                            </div>
                            <div class="stat-footer">
                                <span class="stat-meta">
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    Needs attention
                                </span>
                            </div>
                        </div>

                        <!-- Inventory Value Card -->
                        <div class="stat-card card-success">
                            <div class="stat-card-bg"></div>
                            <div class="stat-header">
                                <div class="stat-icon-wrapper">
                                    <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                                </div>
                                <div class="stat-trend @(stats.InventoryValueTrend >= 0 ? "trend-positive" : "trend-negative")">
                                    <i class="fas fa-arrow-@(stats.InventoryValueTrend >= 0 ? "up" : "down")" aria-hidden="true"></i>
                                    <span>@Math.Abs(stats.InventoryValueTrend)%</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <h3 class="stat-value">@CurrencyFormatter.FormatPrice(stats.TotalInventoryValue)</h3>
                                <p class="stat-label">Inventory Value</p>
                            </div>
                            <div class="stat-footer">
                                <span class="stat-meta">
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    Total worth
                                </span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="charts-section" aria-labelledby="charts-heading">
                    <h2 id="charts-heading" class="section-title">Analytics & Insights</h2>
                    <div class="charts-grid">
                        <!-- Sales/Activity Chart -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title-group">
                                    <div class="chart-icon">
                                        <i class="fas fa-chart-line" aria-hidden="true"></i>
                                    </div>
                                    <div>
                                        <h3 class="chart-title">Sales Activity</h3>
                                        <p class="chart-subtitle">Daily orders over the last 30 days</p>
                                    </div>
                                </div>
                                <div class="chart-actions">
                                    <select class="chart-period-select">
                                        <option value="7">Last 7 days</option>
                                        <option value="30" selected>Last 30 days</option>
                                        <option value="90">Last 90 days</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-body">
                                <canvas id="salesChart" width="400" height="200"></canvas>
                            </div>
                        </div>

                        <!-- Category Distribution Chart -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title-group">
                                    <div class="chart-icon">
                                        <i class="fas fa-chart-pie" aria-hidden="true"></i>
                                    </div>
                                    <div>
                                        <h3 class="chart-title">Category Distribution</h3>
                                        <p class="chart-subtitle">Product breakdown by category</p>
                                    </div>
                                </div>
                                <div class="chart-legend">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #1e3a8a;"></span>
                                        <span class="legend-label">Electronics</span>
                                        <span class="legend-value">45%</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #059669;"></span>
                                        <span class="legend-label">Home & Garden</span>
                                        <span class="legend-value">25%</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #d97706;"></span>
                                        <span class="legend-label">Fashion</span>
                                        <span class="legend-value">20%</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #dc2626;"></span>
                                        <span class="legend-label">Sports</span>
                                        <span class="legend-value">10%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-body">
                                <canvas id="categoryChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Content Grid -->
                <div class="content-grid">
                    <!-- Recent Activities -->
                    <section class="activities-section" aria-labelledby="activities-heading">
                        <div class="content-card">
                            <div class="card-header">
                                <div class="card-title-group">
                                    <div class="card-icon">
                                        <i class="fas fa-clock" aria-hidden="true"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title" id="activities-heading">Recent Activities</h3>
                                        <p class="card-subtitle">Latest system events</p>
                                    </div>
                                </div>
                                <button class="btn-link" aria-label="View all activities">
                                    <span>View All</span>
                                    <i class="fas fa-arrow-right" aria-hidden="true"></i>
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="activity-feed">
                                    @foreach (var activity in FilteredActivities.Take(6))
                                    {
                                        <div class="activity-item">
                                            <div class="activity-avatar">
                                                <i class="fas fa-@(GetActivityIcon(activity.Type))" aria-hidden="true"></i>
                                            </div>
                                            <div class="activity-content">
                                                <div class="activity-title">@activity.Title</div>
                                                <div class="activity-description">@activity.Description</div>
                                                <div class="activity-time">@GetRelativeTime(activity.Timestamp)</div>
                                            </div>
                                            <div class="activity-badge">
                                                <span class="badge badge-@(GetActivityBadgeType(activity.Type))">
                                                    @GetActivityBadgeText(activity.Type)
                                                </span>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Quick Actions Sidebar -->
                    <aside class="sidebar-section" aria-labelledby="actions-heading">
                        <div class="content-card">
                            <div class="card-header">
                                <div class="card-title-group">
                                    <div class="card-icon">
                                        <i class="fas fa-bolt" aria-hidden="true"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title" id="actions-heading">Quick Actions</h3>
                                        <p class="card-subtitle">Common tasks</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="quick-actions">
                                    <button class="action-btn primary" @onclick="NavigateToAddProduct">
                                        <i class="fas fa-plus" aria-hidden="true"></i>
                                        <span>Add Product</span>
                                    </button>
                                    <button class="action-btn primary" @onclick="NavigateToAddCategory">
                                        <i class="fas fa-folder-plus" aria-hidden="true"></i>
                                        <span>Add Category</span>
                                    </button>
                                    <button class="action-btn secondary" @onclick="NavigateToReports">
                                        <i class="fas fa-chart-bar" aria-hidden="true"></i>
                                        <span>View Reports</span>
                                    </button>
                                    <button class="action-btn secondary" @onclick="NavigateToSettings">
                                        <i class="fas fa-cog" aria-hidden="true"></i>
                                        <span>Settings</span>
                                    </button>
                                    <button class="action-btn secondary" @onclick="NavigateToInventory">
                                        <i class="fas fa-boxes" aria-hidden="true"></i>
                                        <span>Manage Inventory</span>
                                    </button>
                                </div>

                                <!-- Top Categories -->
                                <div class="top-categories">
                                    <h4 class="category-title">Top Categories</h4>
                                    <div class="category-list">
                                        <div class="category-item">
                                            <div class="category-info">
                                                <span class="category-name">Electronics</span>
                                                <span class="category-count">342 products</span>
                                            </div>
                                            <div class="category-progress">
                                                <div class="progress-bar">
                                                    <div class="progress-fill" style="width: 45%"></div>
                                                </div>
                                                <span class="progress-text">45%</span>
                                            </div>
                                        </div>
                                        <div class="category-item">
                                            <div class="category-info">
                                                <span class="category-name">Home & Garden</span>
                                                <span class="category-count">189 products</span>
                                            </div>
                                            <div class="category-progress">
                                                <div class="progress-bar">
                                                    <div class="progress-fill" style="width: 25%"></div>
                                                </div>
                                                <span class="progress-text">25%</span>
                                            </div>
                                        </div>
                                        <div class="category-item">
                                            <div class="category-info">
                                                <span class="category-name">Fashion</span>
                                                <span class="category-count">156 products</span>
                                            </div>
                                            <div class="category-progress">
                                                <div class="progress-bar">
                                                    <div class="progress-fill" style="width: 20%"></div>
                                                </div>
                                                <span class="progress-text">20%</span>
                                            </div>
                                        </div>
                                        <div class="category-item">
                                            <div class="category-info">
                                                <span class="category-name">Sports</span>
                                                <span class="category-count">78 products</span>
                                            </div>
                                            <div class="category-progress">
                                                <div class="progress-bar">
                                                    <div class="progress-fill" style="width: 10%"></div>
                                                </div>
                                                <span class="progress-text">10%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        }
    </div>
</div>
