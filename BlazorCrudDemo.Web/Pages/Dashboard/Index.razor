@page "/"
@page "/dashboard"
@using BlazorCrudDemo.Web.Components.Dashboard
@using BlazorCrudDemo.Web.Models
@using System.Globalization
@using Microsoft.AspNetCore.Components

<PageTitle>Dashboard</PageTitle>

<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <h1>Dashboard</h1>
        <div class="header-actions">
            <button class="btn btn-primary" @onclick="RefreshDashboard">
                <i class="fas fa-sync-alt me-2"></i>Refresh
            </button>
        </div>
    </div>

    @if (isLoading)
    {
        <div class="loading-overlay">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p>Loading dashboard data...</p>
        </div>
    }
    else if (hasError)
    {
        <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            An error occurred while loading the dashboard. Please try again later.
            <button class="btn btn-sm btn-outline-danger ms-3" @onclick="RefreshDashboard">
                <i class="fas fa-redo me-1"></i>Retry
            </button>
        </div>
    }
    else
    {
        <!-- Stats Row -->
        <div class="row g-4 mb-4">
            <div class="col-md-6 col-xl-3">
                <StatCard Title="Total Products" 
                         Value="@stats.TotalProducts" 
                         Icon="fas fa-box" 
                         IsHighlighted="true"
                         ShowTrend="true"
                         TrendValue="@stats.ProductsTrend"
                         TrendDirection="@(stats.ProductsTrend >= 0 ? BlazorCrudDemo.Web.Models.TrendDirection.Up : BlazorCrudDemo.Web.Models.TrendDirection.Down)"
                         TrendPeriod="30" />
            </div>
            <div class="col-md-6 col-xl-3">
                <StatCard Title="Total Categories" 
                         Value="@stats.TotalCategories" 
                         Icon="fas fa-folder"
                         ShowTrend="true"
                         TrendValue="@stats.CategoriesTrend"
                         TrendDirection="@(stats.CategoriesTrend >= 0 ? BlazorCrudDemo.Web.Models.TrendDirection.Up : BlazorCrudDemo.Web.Models.TrendDirection.Down)"
                         TrendPeriod="30" />
            </div>
            <div class="col-md-6 col-xl-3">
                <StatCard Title="Low Stock Items" 
                         Value="@stats.LowStockItems" 
                         Icon="fas fa-exclamation-triangle"
                         ShowTrend="true"
                         TrendValue="@stats.LowStockTrend"
                         TrendDirection="@(stats.LowStockTrend <= 0 ? BlazorCrudDemo.Web.Models.TrendDirection.Down : BlazorCrudDemo.Web.Models.TrendDirection.Up)"
                         TrendPeriod="30" />
            </div>
            <div class="col-md-6 col-xl-3">
                <StatCard Title="Total Inventory Value" 
                         Value="@stats.TotalInventoryValue" 
                         Icon="fas fa-dollar-sign"
                         ShowTrend="true"
                         TrendValue="@stats.InventoryValueTrend"
                         TrendDirection="@(stats.InventoryValueTrend >= 0 ? BlazorCrudDemo.Web.Models.TrendDirection.Up : BlazorCrudDemo.Web.Models.TrendDirection.Down)"
                         TrendPeriod="30" />
            </div>
        </div>

        <div class="row g-4">
            <!-- Recent Activities -->
            <div class="col-lg-8">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Recent Activities</h5>
                    </div>
                    <div class="card-body p-0">
                        <ActivityFeed Activities="recentActivities" />
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Quick Actions</h5>
                    </div>
                    <div class="card-body p-0">
                        <QuickActions />
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .dashboard-container {
        padding: 1.5rem;
    }

    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .header-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .card {
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
    }

    .card-header {
        background-color: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
        padding: 1rem 1.25rem;
        border-top-left-radius: 0.5rem !important;
        border-top-right-radius: 0.5rem !important;
    }

    .card-title {
        font-size: 1rem;
        font-weight: 600;
        color: #1e293b;
        margin: 0;
    }

    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.8);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .loading-overlay p {
        margin-top: 1rem;
        color: #64748b;
        font-weight: 500;
    }
</style>

@code {
    public partial class DashboardIndex : ComponentBase
    {
    [Inject] private HttpClient Http { get; set; } = default!;
    [Inject] private ILogger<DashboardIndex> Logger { get; set; } = default!;

    // Quick actions list - using default from QuickActions component
    // public List<QuickAction> quickActions = new()
    // {
    //     new QuickAction { Title = "Add Product", Icon = "fas fa-plus", Url = "/products/add" },
    //     new QuickAction { Title = "View Reports", Icon = "fas fa-chart-bar", Url = "/reports" },
    //     new QuickAction { Title = "Manage Categories", Icon = "fas fa-tags", Url = "/categories" },
    //     new QuickAction { Title = "Settings", Icon = "fas fa-cog", Url = "/settings" }
    // };
}
}
